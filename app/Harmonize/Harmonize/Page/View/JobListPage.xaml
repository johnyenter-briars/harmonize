<?xml version="1.0" encoding="utf-8" ?>
<pages:BasePage 
             xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:views="clr-namespace:Harmonize.Page.View"
             xmlns:pages="clr-namespace:Harmonize.Page"
             xmlns:toolkit="http://schemas.microsoft.com/dotnet/2022/maui/toolkit"
             xmlns:viewModels="clr-namespace:Harmonize.ViewModel"
             x:TypeArguments="viewModels:JobListViewModel"
             x:DataType="viewModels:JobListViewModel"
             x:Class="Harmonize.Page.View.JobListPage"
             xmlns:model="clr-namespace:Harmonize.Model"
             xmlns:job="clr-namespace:Harmonize.Client.Model.Job;assembly=Harmonize.Client"
             xmlns:components="clr-namespace:Harmonize.Components"
             Title="Job List">

    <StackLayout Padding="10">
        <Frame 
            BackgroundColor="{StaticResource Gray900}" 
            BorderColor="DarkGray" 
            CornerRadius="10" 
            Padding="5"
            IsVisible="{Binding SearchBarVisible}"
            Margin="0, 0, 0, 10"
            >

            <SearchBar 
                IsVisible="{Binding SearchBarVisible}"
                Grid.Row="0"
                Grid.ColumnSpan="2"
                Placeholder="Search..."
                SearchCommand="{Binding SearchCommand}"
                SearchCommandParameter="{Binding ., Source={x:Reference searchBar}}"
                Text="{Binding SearchQuery}" 
                FontSize="18"
                HeightRequest="40"
                VerticalOptions="Start"
                HorizontalOptions="FillAndExpand"
                x:Name="searchBar"
                TextColor="{StaticResource OffWhite}"
                />

        </Frame>

        <RefreshView 
            IsRefreshing="{Binding FetchingData}" 
            Command="{Binding RefreshCommand}"
            >
            <CollectionView 
                IsVisible="True"
                RemainingItemsThreshold="1"
                RemainingItemsThresholdReachedCommand="{Binding LoadMoreCommand}"
                ItemsSource="{Binding Jobs}"
                VerticalScrollBarVisibility="Always"
                SelectionMode="Single"
                >

                <CollectionView.ItemTemplate>
                    <DataTemplate x:DataType="job:Job">
                        <components:ListElement>
                            <Grid
                                ColumnDefinitions="*, Auto"
                                RowDefinitions="Auto, *, *, *"
                                >
                                <Label
                                    Grid.Row="0"
                                    Grid.ColumnSpan="2"
                                    Text="{Binding Description}" 
                                    FontAttributes="Bold" 
                                    />
                                <BoxView
                                    Grid.Row="1"
                                    Grid.ColumnSpan="2"
                                    HeightRequest="1" Color="{StaticResource Gray400}"/>
                                <Label
                                    Grid.Row="2"
                                    Grid.Column="0"
                                    TextColor="{StaticResource Gray200}"
                                    Text="{Binding Status}" 
                                    VerticalOptions="Center"
                                    />
                                <Label
                                    Grid.Row="2"
                                    Grid.Column="1"
                                    TextColor="{StaticResource Gray200}"
                                    Text="{Binding StartedOn}" 
                                    VerticalOptions="Center"
                                    />
                            </Grid>
                        </components:ListElement>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
                <CollectionView.Footer>
                    <ActivityIndicator IsRunning="{Binding FetchingData}" />
                </CollectionView.Footer>
            </CollectionView>
        </RefreshView>
    </StackLayout>
</pages:BasePage>